map "http://fhir.org/guides/who/smart-immunization/StructureMap/IMMZ-C-QRToLM" = "IMMZ-C-QRToLM"

uses "http://hl7.org/fhir/StructureDefinition/QuestionnaireResponse" alias QResp as source
uses "http://fhir.org/guides/who/smart-immunization/StructureDefinition/IMMZ-C-register-client" alias IMMZC as target

group QRespToIMMZC (
  source qr : QResp,
  target immzc : IMMZC
) {
  qr.item as item then {

    item.answer first as answer where item.linkId = 'uniqueId' then {
      answer.value as content -> immzc.uniqueId = content  "set identifier";
    } "first answer for identifier";

  } "process items";

}

group NameToIMMZC( 
  source name,
  target immzc
) {
  name.item as item then {

    item.answer first as answer where item.linkId = 'fullName' then {
      answer.value as content -> immzc.name = content "set full name";
    } "first answer for full name";

    item.answer first as answer where item.linkId = 'firstName' then {
      answer.value as content -> immzc.firstName = content "set first name";
    } "first answer for first name";

    item.answer first as answer where item.linkId = 'familyName' then {
      answer.value as content -> immzc.familyName = content "set family name";
    } "first answer for family name";

  } "process name items";
}